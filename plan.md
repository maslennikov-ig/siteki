# Обновлённый план интеграции оплаты через Тинькофф (Т-банк) и amoCRM

## 1. Подключение и настройка интеграции ✅ (Выполнено)
- Получить доступ к личному кабинету Т-банк (заявка на amocrm@tbank.ru, указать ИНН, ФИО, email, телефон).
- В личном кабинете создать магазин типа «Интернет-магазин».
- Получить терминал и пароль для интеграции.

## 2. Установка модуля Т-банк в amoCRM
- В amoCRM: amoМаркет → найти модуль «Платёжный модуль Т-Банк» → установить.
- В настройках модуля: указать терминал, пароль и email.
- (Опционально) Включить передачу чеков, указать систему налогообложения и параметры для чека.

## 3. Настройка amoPay
- После установки интеграции добавить Т-банк в amoPAY (раздел Счета/покупки → НАСТРОЙКА AMOPAY).
- В amoPAY добавить эквайринг Т-банк, сохранить.

## 4. Интеграция на сайте
- Использовать официальный скрипт integration.js от Т-банк для открытия платёжной формы в iframe или модальном окне.
- Для каждого продукта на сайте при клике на кнопку «Купить» формировать параметры оплаты (название, сумма, id продукта).
- Вызов скрипта оплаты инициирует создание ссылки на оплату через backend (или через amoCRM API, если работает через amoPay).
- В платёжной форме клиент вводит email и телефон (если не подтягиваются автоматически).

## 5. Передача данных и автоматизация
- После успешной оплаты данные автоматически попадают в amoCRM: создаётся сделка, контакт и задача (если настроено через amoPay и модуль Т-банк).
- В amoCRM можно отслеживать статус оплаты, скачивать чек, автоматизировать задачи для менеджера.

## 6. UX и страница «Спасибо»
- После успешной оплаты показывать отдельную страницу «Спасибо» с ссылкой на скачивание продукта и инструкцией.
- Для неуспешной оплаты — информировать пользователя и предлагать повторить попытку или связаться с поддержкой.

## 7. Мобильная и десктоп-адаптация
- Использовать iframe/модальное окно — поддерживается на мобильных и десктопах.
- Проверить корректность отображения платёжной формы на всех устройствах.

## 8. Безопасность
- Не хранить персональные данные на сайте, всё уходит в amoCRM.
- Защита от повторных оплат реализуется через уникальный orderId на каждую попытку.

## 9. Тестирование
- Проверить оплату по всем продуктам.
- Проверить автоматическую передачу данных в amoCRM (успешная и неуспешная оплата).
- Проверить UX на мобильных и десктопе.

---

**Выводы из документации:**
- Модуль Т-банк для amoCRM полностью автоматизирует передачу данных о платеже.
- amoPay позволяет формировать счёт и ссылку на оплату прямо из amoCRM, а также отслеживать статус оплаты.
- На сайте используется integration.js для вызова формы оплаты, а процесс передачи данных автоматизирован через amoCRM и модуль Т-банк.
- Для корректной работы нужно предварительно настроить интеграцию в amoCRM и личном кабинете Т-банк.


## 1. Выбор платёжного модуля
- Используем JS-интеграцию от Т-банк: [https://www.tbank.ru/kassa/dev/integrationjs/](https://www.tbank.ru/kassa/dev/integrationjs/)
- Проверить, поддерживает ли модуль Amopay автоматическую передачу данных в amoCRM (если да — используем его, если нет — реализуем передачу через REST API amoCRM)

## 2. Логика выбора продукта
- На сайте уже выделены 3 продукта, у каждого своя кнопка оплаты
- При клике на кнопку "Купить"/"Оплатить" сохраняем id/название продукта и его стоимость
- Открываем платёжную форму Т-банк с нужной суммой и названием продукта

## 3. Оформление оплаты
- В платёжной форме Т-банк клиент вводит email и телефон (если модуль позволяет — делаем обязательными)
- После успешной оплаты получаем callback/ответ от JS-модуля (без серверного callback)
- В случае неуспешной оплаты — также получаем результат

## 4. Передача данных в amoCRM
- Передаём следующие данные в amoCRM:
    - email клиента
    - телефон клиента
    - выбранный продукт
    - сумма оплаты
    - статус оплаты (успех/неуспех)
    - (опционально) дата/время и ID платежа
- Если Amopay позволяет автоматизировать этот процесс — используем его
- Если нет — используем REST API amoCRM для создания сделки, контакта и задачи связаться с клиентом
- Формат передачи уточнить по официальной документации amoCRM и Amopay

## 5. UX и страница "Спасибо"
- После успешной оплаты показываем отдельную страницу (или модальное окно) "Спасибо за покупку"
    - На ней размещаем ссылку на скачивание продукта
    - Краткую инструкцию по дальнейшим действиям
- Для неуспешной оплаты — информируем пользователя и предлагаем повторить попытку или связаться с поддержкой

## 6. Мобильная и десктоп-адаптация
- Проверить, корректно ли работает платёжная форма Т-банк на мобильных устройствах (использовать встроенные методы оплаты, если доступны)
- Обеспечить удобство UX для всех устройств

## 7. Безопасность
- Проверить, чтобы нельзя было инициировать повторную оплату случайно
- Не хранить персональные данные на сайте, всё уходит в amoCRM

## 8. Тестирование
- Проверить оплату на всех трёх продуктах
- Проверить передачу данных в amoCRM (успешная и неуспешная оплата)
- Проверить UX на мобильных и десктопе

---

### P.S.
- Если Amopay полностью закрывает задачу интеграции с amoCRM — используем его, иначе реализуем передачу через REST API.
- В дальнейшем можно добавить сбор utm-меток и источника трафика для передачи в amoCRM.
- Все детали по API и передаче данных уточнять по официальной документации amoCRM и Т-банк (Тинькофф).
