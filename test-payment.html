<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –ø–ª–∞—Ç–µ–∂–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –¢-–±–∞–Ω–∫–∞</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .test-button { background: #ff6600; color: white; padding: 12px 24px; border: none; border-radius: 6px; cursor: pointer; margin: 10px 5px; font-size: 16px; }
        .test-button:hover { background: #e55a00; }
        .log { background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px; padding: 10px; margin: 10px 0; max-height: 300px; overflow-y: auto; font-family: monospace; font-size: 12px; }
        .status { padding: 10px; margin: 10px 0; border-radius: 4px; }
        .status.success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .status.error { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .status.info { background: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; }
        .status.warning { background: #fff3cd; border: 1px solid #ffeaa7; color: #856404; }
        .loading-spinner { display: inline-block; width: 20px; height: 20px; border: 3px solid #f3f3f3; border-top: 3px solid #0c5460; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ –¢–µ—Å—Ç –ø–ª–∞—Ç–µ–∂–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –¢-–±–∞–Ω–∫–∞</h1>
        
        <div id="status" class="status info">
            <div class="loading-spinner"></div>
            <strong>–°—Ç–∞—Ç—É—Å:</strong> –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã...
        </div>

        <h3>–¢–µ—Å—Ç–æ–≤—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã:</h3>
        
        <button class="test-button" data-tinkoff-pay="guide-1399">
            üí° –¢–µ—Å—Ç: –ì–∞–π–¥ –∑–∞ 1399 ‚ÇΩ
        </button>
        
        <button class="test-button" data-tinkoff-pay="consult-5000">
            üí¨ –¢–µ—Å—Ç: –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –∑–∞ 5000 ‚ÇΩ
        </button>
        
        <button class="test-button" data-tinkoff-pay="fullsupport-5000">
            üéØ –¢–µ—Å—Ç: –ü–æ–ª–Ω–æ–µ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ –∑–∞ 5000 ‚ÇΩ
        </button>

        <h3>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã:</h3>
        
        <button class="test-button" onclick="testSimplePayment()">
            üîß –¢–µ—Å—Ç –ø—Ä–æ—Å—Ç–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞
        </button>
        
        <button class="test-button" onclick="checkScriptStatus()">
            üìä –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–∫—Ä–∏–ø—Ç–∞
        </button>
        
        <button class="test-button" onclick="testNetworkAccess()">
            üåê –¢–µ—Å—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ API –¢-–±–∞–Ω–∫–∞
        </button>
        
        <button class="test-button" onclick="testTerminalPassword()">
            üîê –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞—Ä–æ–ª—å —Ç–µ—Ä–º–∏–Ω–∞–ª–∞
        </button>
        
        <button class="test-button" onclick="clearLog()">
            üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥
        </button>

        <h3>–õ–æ–≥ –æ–ø–µ—Ä–∞—Ü–∏–π:</h3>
        <div id="log" class="log"></div>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –Ω–∞—à —Å–∫—Ä–∏–ø—Ç –æ–ø–ª–∞—Ç—ã -->
    <script src="tbank-payment.js"></script>
    
    <script>
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ console –î–û –∏—Ö –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è
        let loadingStage = 'init';
        let startTime = Date.now();
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const elapsed = ((Date.now() - startTime) / 1000).toFixed(1);
            const logEntry = `[${timestamp}] [+${elapsed}s] ${message}\n`;
            logDiv.textContent += logEntry;
            logDiv.scrollTop = logDiv.scrollHeight;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
            updateStatus(message, type);
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º originalLog –≤–º–µ—Å—Ç–æ console.log –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è —Ü–∏–∫–ª–∏—á–µ—Å–∫–æ–≥–æ –≤—ã–∑–æ–≤–∞
            originalLog(`[Payment Test] ${message}`);
        }
        
        function updateStatus(message, type) {
            const statusDiv = document.getElementById('status');
            statusDiv.className = `status ${type}`;
            
            let icon = '';
            switch(type) {
                case 'success': icon = '‚úÖ'; break;
                case 'error': icon = '‚ùå'; break;
                case 'warning': icon = '‚ö†Ô∏è'; break;
                default: icon = '‚ÑπÔ∏è'; break;
            }
            
            const spinner = type === 'info' && message.includes('–ó–∞–≥—Ä—É–∑–∫–∞') ? 
                '<div class="loading-spinner"></div>' : '';
            
            statusDiv.innerHTML = `${spinner}<strong>${icon} –°—Ç–∞—Ç—É—Å:</strong> ${message}`;
        }

        // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º –∫–æ–Ω—Å–æ–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
        console.log = function(...args) {
            originalLog.apply(console, arguments);
        };
        
        console.error = function(...args) {
            originalError.apply(console, arguments);
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, arguments);
        };

        // –ù–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        log('üöÄ –¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∫—É', 'info');
        updateStatus('–ó–∞–≥—Ä—É–∑–∫–∞ —Å–∫—Ä–∏–ø—Ç–∞ tbank-payment.js...', 'info');

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–æ–≤
        function checkScriptLoading() {
            const scripts = document.querySelectorAll('script');
            scripts.forEach((script, index) => {
                if (script.src) {
                    log(`üìÑ –ù–∞–π–¥–µ–Ω —Å–∫—Ä–∏–ø—Ç: ${script.src}`, 'info');
                    
                    script.addEventListener('load', () => {
                        log(`‚úÖ –°–∫—Ä–∏–ø—Ç –∑–∞–≥—Ä—É–∂–µ–Ω: ${script.src}`, 'success');
                    });
                    
                    script.addEventListener('error', () => {
                        log(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–∞: ${script.src}`, 'error');
                    });
                }
            });
        }

        // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ DOM
        document.addEventListener('DOMContentLoaded', function() {
            log('üéØ DOM –∑–∞–≥—Ä—É–∂–µ–Ω, –Ω–∞—á–∏–Ω–∞–µ–º –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É...', 'success');
            updateStatus('DOM –∑–∞–≥—Ä—É–∂–µ–Ω, –ø—Ä–æ–≤–µ—Ä—è–µ–º –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é...', 'info');
            
            checkScriptLoading();
            
            // –ù–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API
            setTimeout(() => {
                log('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API (1 —Å–µ–∫)...', 'info');
                
                if (window.TbankPayment) {
                    log('‚úÖ TbankPayment API –¥–æ—Å—Ç—É–ø–µ–Ω', 'success');
                    updateStatus('TbankPayment API —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω', 'success');
                } else {
                    log('‚ùå TbankPayment API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ 1 —Å–µ–∫', 'error');
                    updateStatus('–û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ TbankPayment API...', 'warning');
                }
                
                if (typeof PaymentIntegration !== 'undefined') {
                    log('‚úÖ PaymentIntegration –¥–æ—Å—Ç—É–ø–µ–Ω', 'success');
                } else {
                    log('‚ö†Ô∏è PaymentIntegration –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (–Ω–æ—Ä–º–∞–ª—å–Ω–æ –Ω–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ)', 'warning');
                }
            }, 1000);
            
            // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                log('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API (3 —Å–µ–∫)...', 'info');
                
                if (window.TbankPayment) {
                    log('‚úÖ TbankPayment API –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É –¥–æ—Å—Ç—É–ø–µ–Ω', 'success');
                } else {
                    log('‚ùå TbankPayment API –≤—Å–µ –µ—â–µ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ 3 —Å–µ–∫', 'error');
                    updateStatus('–û–®–ò–ë–ö–ê: TbankPayment API –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è', 'error');
                }
                
                if (typeof PaymentIntegration !== 'undefined') {
                    log('‚úÖ PaymentIntegration —Ç–µ–ø–µ—Ä—å –¥–æ—Å—Ç—É–ø–µ–Ω', 'success');
                    updateStatus('–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¢-–±–∞–Ω–∫–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≥—Ä—É–∂–µ–Ω–∞', 'success');
                } else {
                    log('‚ùå PaymentIntegration –≤—Å–µ –µ—â–µ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω', 'warning');
                    updateStatus('PaymentIntegration –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è (–±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω fallback)', 'warning');
                }
            }, 3000);
            
            // –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                log('üèÅ –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (10 —Å–µ–∫)...', 'info');
                if (!window.TbankPayment) {
                    updateStatus('–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: –ü–ª–∞—Ç–µ–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–∞—Å—å', 'error');
                }
            }, 10000);
        });

        // –¢–µ—Å—Ç –ø—Ä–æ—Å—Ç–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞
        async function testSimplePayment() {
            log('üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞ –ø—Ä–æ—Å—Ç–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞...', 'info');
            updateStatus('–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞...', 'info');
            
            if (!window.TbankPayment || !window.TbankPayment.createSimplePayment) {
                log('‚ùå –§—É–Ω–∫—Ü–∏—è createSimplePayment –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞', 'error');
                updateStatus('–û—à–∏–±–∫–∞: —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–æ—Å—Ç–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞', 'error');
                return;
            }
            
            const testProduct = {
                id: 'test-100',
                name: '–¢–µ—Å—Ç–æ–≤—ã–π –ø—Ä–æ–¥—É–∫—Ç',
                price: 100
            };
            
            try {
                await window.TbankPayment.createSimplePayment(testProduct);
                log('‚úÖ –ü—Ä–æ—Å—Ç–æ–π –ø–ª–∞—Ç–µ–∂ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω', 'success');
                updateStatus('–ü—Ä–æ—Å—Ç–æ–π –ø–ª–∞—Ç–µ–∂ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ', 'success');
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Å—Ç–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞: ${error.message}`, 'error');
                updateStatus(`–û—à–∏–±–∫–∞ –ø—Ä–æ—Å—Ç–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞: ${error.message}`, 'error');
            }
        }

        // –¢–µ—Å—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–µ—Ç–∏
        async function testNetworkAccess() {
            log('üåê –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ API –¢-–±–∞–Ω–∫–∞...', 'info');
            updateStatus('–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–µ–≤–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ API...', 'info');
            
            const endpoints = [
                'https://acq-paymentform-integrationjs.t-static.ru/integration.js',
                'https://securepay.tinkoff.ru/v2/Init'
            ];
            
            for (const endpoint of endpoints) {
                try {
                    log(`üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å: ${endpoint}`, 'info');
                    
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 5000);
                    
                    const response = await fetch(endpoint, {
                        method: 'HEAD',
                        signal: controller.signal,
                        mode: 'no-cors' // –î–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è CORS –ø—Ä–æ–±–ª–µ–º –ø—Ä–∏ —Ç–µ—Å—Ç–µ
                    });
                    
                    clearTimeout(timeoutId);
                    log(`‚úÖ ${endpoint} - –¥–æ—Å—Ç—É–ø–µ–Ω`, 'success');
                    
                } catch (error) {
                    if (error.name === 'AbortError') {
                        log(`‚è±Ô∏è ${endpoint} - —Ç–∞–π–º–∞—É—Ç (>5—Å–µ–∫)`, 'warning');
                    } else {
                        log(`‚ùå ${endpoint} - –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω: ${error.message}`, 'error');
                    }
                }
            }
            
            // –°–ü–ï–¶–ò–ê–õ–¨–ù–´–ô –¢–ï–°–¢ –î–õ–Ø –í–ê–®–ï–ì–û –¢–ï–†–ú–ò–ù–ê–õ–ê –° –ü–†–ê–í–ò–õ–¨–ù–û–ô –ì–ï–ù–ï–†–ê–¶–ò–ï–ô TOKEN
            log('üéØ –¢–µ—Å—Ç–∏—Ä—É–µ–º –≤–∞—à —Ç–µ—Ä–º–∏–Ω–∞–ª 1749023114115DEMO —Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π Token...', 'info');
            
            try {
                // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π –ø—Ä–æ–¥—É–∫—Ç –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ tbank-payment.js
                const testProduct = {
                    id: 'terminal-test',
                    name: '–¢–µ—Å—Ç —Ç–µ—Ä–º–∏–Ω–∞–ª–∞',
                    price: 1 // 1 —Ä—É–±–ª—å –¥–ª—è —Ç–µ—Å—Ç–∞
                };
                
                log('üìã –¢–µ—Å—Ç–æ–≤—ã–π –ø—Ä–æ–¥—É–∫—Ç: ' + JSON.stringify(testProduct), 'info');
                
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é createSimplePayment –∏–∑ tbank-payment.js –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç Token
                if (window.TbankPayment && window.TbankPayment.createSimplePayment) {
                    log('üîß –ò—Å–ø–æ–ª—å–∑—É–µ–º createSimplePayment —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π Token...', 'info');
                    
                    try {
                        const result = await window.TbankPayment.createSimplePayment(testProduct);
                        log('‚úÖ –¢–µ—Å—Ç —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ –£–°–ü–ï–®–ï–ù! Token —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!', 'success');
                        log('üí° PaymentURL –ø–æ–ª—É—á–µ–Ω: ' + result.PaymentURL, 'success');
                        updateStatus('–¢–µ—Ä–º–∏–Ω–∞–ª —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å Token', 'success');
                        
                        // –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –ø–ª–∞—Ç–µ–∂
                        if (confirm('‚úÖ –¢–µ—Ä–º–∏–Ω–∞–ª —Ä–∞–±–æ—Ç–∞–µ—Ç! –û—Ç–∫—Ä—ã—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –ø–ª–∞—Ç–µ–∂ –Ω–∞ 1 —Ä—É–±–ª—å?')) {
                            window.open(result.PaymentURL, '_blank', 'width=600,height=800,scrollbars=yes,resizable=yes');
                        }
                        
                        return; // –£—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–∏–ª–∏
                        
                    } catch (paymentError) {
                        log('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–ª–∞—Ç–µ–∂–∞ —Å Token: ' + paymentError.message, 'error');
                        log('üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –æ—à–∏–±–∫–∏...', 'info');
                    }
                } else {
                    log('‚ùå TbankPayment.createSimplePayment –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω', 'error');
                }
                
                // Fallback: –ø—Ä—è–º–æ–π —Ç–µ—Å—Ç –±–µ–∑ Token (–¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏)
                log('üîç –í—ã–ø–æ–ª–Ω—è–µ–º –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç –±–µ–∑ Token...', 'info');
                const testPaymentData = {
                    TerminalKey: '1749023114115DEMO',
                    Amount: 100, // 1 —Ä—É–±–ª—å –≤ –∫–æ–ø–µ–π–∫–∞—Ö
                    OrderId: 'terminal-test-' + Date.now(),
                    Description: '–î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç —Ç–µ—Ä–º–∏–Ω–∞–ª–∞'
                };
                
                log('üìã –î–∞–Ω–Ω—ã–µ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ç–µ—Å—Ç–∞: ' + JSON.stringify(testPaymentData), 'info');
                
                const terminalResponse = await fetch('https://securepay.tinkoff.ru/v2/Init', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(testPaymentData)
                });
                
                const terminalResult = await terminalResponse.json();
                log('üì® –û—Ç–≤–µ—Ç –æ—Ç API (–±–µ–∑ Token): ' + JSON.stringify(terminalResult), 
                    terminalResult.Success ? 'success' : 'error');
                
                if (terminalResult.Success) {
                    log('‚úÖ –¢–µ—Ä–º–∏–Ω–∞–ª —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –±–µ–∑ Token!', 'success');
                    log('üí° PaymentURL: ' + terminalResult.PaymentURL, 'success');
                    updateStatus('–¢–µ—Ä–º–∏–Ω–∞–ª —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ', 'success');
                } else {
                    log('‚ùå –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç –ø—Ä–æ–≤–∞–ª–µ–Ω: ' + terminalResult.Message, 'error');
                    log('üí° –ö–æ–¥ –æ—à–∏–±–∫–∏: ' + terminalResult.ErrorCode, 'error');
                    
                    // –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Ç–∏–ø–∏—á–Ω—ã—Ö –æ—à–∏–±–æ–∫
                    if (terminalResult.ErrorCode === '9999') {
                        log('üîß –î–ò–ê–ì–ù–û–ó: –¢—Ä–µ–±—É–µ—Ç—Å—è Token (SHA-256 –ø–æ–¥–ø–∏—Å—å)', 'warning');
                        log('üîß –ü–†–û–ë–õ–ï–ú–ê: –ü–∞—Ä–æ–ª—å —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ –Ω–µ –∑–∞–¥–∞–Ω –∏–ª–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è Token –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç', 'warning');
                        updateStatus('–¢—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Token', 'warning');
                    } else if (terminalResult.ErrorCode === '7') {
                        log('üîß –†–ï–®–ï–ù–ò–ï: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ –≤ –õ–ö –¢-–±–∞–Ω–∫–∞', 'warning');
                        log('üîß –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Ç–∏–ø –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è "–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π"', 'warning');
                        updateStatus('–ü—Ä–æ–±–ª–µ–º–∞ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞', 'warning');
                    } else {
                        updateStatus(`–û—à–∏–±–∫–∞ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞: ${terminalResult.ErrorCode}`, 'error');
                    }
                }
                
            } catch (terminalError) {
                log('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞: ' + terminalError.message, 'error');
                updateStatus('–û—à–∏–±–∫–∞ —Å–µ—Ç–µ–≤–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ç–µ—Ä–º–∏–Ω–∞–ª—É', 'error');
            }
            
            log('üèÅ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–µ–≤–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞', 'info');
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å–∫—Ä–∏–ø—Ç–∞
        function checkScriptStatus() {
            log('üìä –ü–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏...', 'info');
            updateStatus('–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞...', 'info');
            
            const checks = [
                { name: 'TbankPayment API', check: () => !!window.TbankPayment },
                { name: 'PaymentIntegration', check: () => typeof PaymentIntegration !== 'undefined' },
                { name: 'tbankIntegration', check: () => !!window.tbankIntegration },
                { name: 'HTTPS Protocol', check: () => location.protocol === 'https:' || location.hostname === 'localhost' },
                { name: 'Integration Script', check: () => !!document.querySelector('script[src*="integration.js"]') },
                { name: 'Main Payment Script', check: () => !!document.querySelector('script[src*="tbank-payment.js"]') }
            ];
            
            let successCount = 0;
            checks.forEach(({ name, check }) => {
                const status = check();
                if (status) successCount++;
                log(`${status ? '‚úÖ' : '‚ùå'} ${name}: ${status ? 'OK' : 'FAIL'}`, status ? 'success' : 'error');
            });
            
            // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
            log(`üåê URL: ${window.location.href}`, 'info');
            log(`üîß User Agent: ${navigator.userAgent.substring(0, 50)}...`, 'info');
            log(`‚è±Ô∏è –í—Ä–µ–º—è —Å –∑–∞–≥—Ä—É–∑–∫–∏: ${((Date.now() - startTime) / 1000).toFixed(1)} —Å–µ–∫`, 'info');
            
            const percentage = Math.round((successCount / checks.length) * 100);
            updateStatus(`–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞: ${successCount}/${checks.length} –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ (${percentage}%)`, 
                percentage > 50 ? 'success' : 'error');
        }

        // –û—á–∏—Å—Ç–∫–∞ –ª–æ–≥–∞
        function clearLog() {
            document.getElementById('log').textContent = '';
            log('üóëÔ∏è –õ–æ–≥ –æ—á–∏—â–µ–Ω', 'info');
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
        window.addEventListener('error', function(e) {
            log(`üí• JavaScript Error: ${e.error?.message || e.message} at ${e.filename}:${e.lineno}`, 'error');
        });
        
        window.addEventListener('unhandledrejection', function(e) {
            log(`üí• Unhandled Promise Rejection: ${e.reason}`, 'error');
        });
        
        // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ—Å—É—Ä—Å–æ–≤
        window.addEventListener('beforeunload', function() {
            log('üö™ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—ã–≥—Ä—É–∂–∞–µ—Ç—Å—è...', 'info');
        });

        // –¢–µ—Å—Ç –ø–∞—Ä–æ–ª—è —Ç–µ—Ä–º–∏–Ω–∞–ª–∞
        function testTerminalPassword() {
            log('üîê –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–∞—Ä–æ–ª—è —Ç–µ—Ä–º–∏–Ω–∞–ª–∞...', 'info');
            updateStatus('–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è —Ç–µ—Ä–º–∏–Ω–∞–ª–∞...', 'info');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ Token
            if (!window.TbankPayment) {
                log('‚ùå TbankPayment API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω', 'error');
                updateStatus('–û—à–∏–±–∫–∞: TbankPayment API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω', 'error');
                return;
            }
            
            log('üè™ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞...', 'info');
            
            try {
                // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π –ø—Ä–æ–¥—É–∫—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ Token
                const testProduct = {
                    id: 'password-test',
                    name: '–¢–µ—Å—Ç –ø–∞—Ä–æ–ª—è —Ç–µ—Ä–º–∏–Ω–∞–ª–∞',
                    price: 1
                };
                
                log('üìã –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ: ' + JSON.stringify(testProduct), 'info');
                
                // –ü—ã—Ç–∞–µ–º—Å—è —Å–æ–∑–¥–∞—Ç—å –ø–ª–∞—Ç–µ–∂ —Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π Token
                log('üîê –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥–µ–Ω–µ—Ä–∞—Ü–∏—é Token...', 'info');
                
                window.TbankPayment.createSimplePayment(testProduct)
                    .then(result => {
                        log('‚úÖ –ü–ê–†–û–õ–¨ –¢–ï–†–ú–ò–ù–ê–õ–ê –ù–ê–°–¢–†–û–ï–ù –ö–û–†–†–ï–ö–¢–ù–û!', 'success');
                        log('‚úÖ Token —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –∏ –ø—Ä–∏–Ω—è—Ç API', 'success');
                        log('üí° PaymentURL –ø–æ–ª—É—á–µ–Ω: ' + result.PaymentURL, 'success');
                        updateStatus('–ü–∞—Ä–æ–ª—å —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ', 'success');
                        
                        // –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º –æ—Ç–∫—Ä—ã—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –ø–ª–∞—Ç–µ–∂
                        if (confirm('‚úÖ –ü–∞—Ä–æ–ª—å —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω! –û—Ç–∫—Ä—ã—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –ø–ª–∞—Ç–µ–∂?')) {
                            window.open(result.PaymentURL, '_blank', 'width=600,height=800,scrollbars=yes,resizable=yes');
                        }
                    })
                    .catch(error => {
                        log('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ Token: ' + error.message, 'error');
                        
                        if (error.message.includes('Token –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø—É—Å—Ç—ã–º') || 
                            error.message.includes('–ù–µ–≤–µ—Ä–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã')) {
                            log('üîß –î–ò–ê–ì–ù–û–ó: –ü–∞—Ä–æ–ª—å —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ –ù–ï –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏–ª–∏ –Ω–µ–≤–µ—Ä–Ω—ã–π', 'error');
                            updateStatus('–ü–∞—Ä–æ–ª—å —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ —Ç—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏', 'error');
                        } else if (error.message.includes('–¢—Ä–µ–±—É–µ—Ç—Å—è –ø–∞—Ä–æ–ª—å —Ç–µ—Ä–º–∏–Ω–∞–ª–∞')) {
                            log('üîß –î–ò–ê–ì–ù–û–ó: –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞ TERMINAL_PASSWORD –ø—É—Å—Ç–∞—è', 'error');
                            updateStatus('–ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–æ–ª—å –≤ –∫–æ–¥', 'error');
                        } else {
                            log('üîß –î–ò–ê–ì–ù–û–ó: –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ Token', 'error');
                            updateStatus('–û—à–∏–±–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Token', 'error');
                        }
                        
                        // –í—ã–≤–æ–¥–∏–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ
                        log('üìñ –ò–ù–°–¢–†–£–ö–¶–ò–Ø –ü–û –ù–ê–°–¢–†–û–ô–ö–ï –ü–ê–†–û–õ–Ø:', 'warning');
                        log('1. –û—Ç–∫—Ä–æ–π—Ç–µ –õ–ö –¢-–±–∞–Ω–∫–∞: business.tbank.ru', 'warning');
                        log('2. –†–∞–∑–¥–µ–ª "–ú–∞–≥–∞–∑–∏–Ω—ã" ‚Üí "–¢–µ—Ä–º–∏–Ω–∞–ª—ã"', 'warning');
                        log('3. –¢–µ—Ä–º–∏–Ω–∞–ª: 1749023114115DEMO', 'warning');
                        log('4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ "–ü–∞—Ä–æ–ª—å —Ç–µ—Ä–º–∏–Ω–∞–ª–∞"', 'warning');
                        log('5. –í tbank-payment.js –∑–∞–º–µ–Ω–∏—Ç–µ:', 'warning');
                        log('   const TERMINAL_PASSWORD = \'*TS^0fvYzv$s_fu$\';', 'warning');
                        log('   –Ω–∞ –≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π –ø–∞—Ä–æ–ª—å', 'warning');
                        log('6. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ñ–∞–π–ª –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É', 'warning');
                    });
                
            } catch (error) {
                log('‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –ø–∞—Ä–æ–ª—è: ' + error.message, 'error');
                updateStatus('–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–∞—Ä–æ–ª—è', 'error');
            }
        }
    </script>
</body>
</html> 